# Makefile

## 1. Makefile 的作用

Makefile 是一种构建工具，它可以自动化完成程序的编译、链接、打包等工作，从而提高开发效率。

## 2. Makefile 的基本语法

Makefile 由一系列规则组成，每条规则的语法如下：

```makefile
<target> : <prerequisites>
    <commands>
```

其中，`target`是规则的目标，`prerequisites`是规则的依赖，`commands`是规则的命令。

## 3. Makefile 的执行过程

Makefile 的执行过程如下：

1. 读取 Makefile 文件，查找目标文件和依赖文件；
2. 比较目标文件和依赖文件的修改时间，如果目标文件不存在或者依赖文件的修改时间比目标文件的修改时间新，则执行命令；
3. 如果目标文件存在且依赖文件的修改时间比目标文件的修改时间旧，则不执行命令。
4. 重复上述过程，直到所有的目标文件都被更新。

## 4. Makefile 的变量

Makefile 的变量分为两种：系统变量和自定义变量。

### 4.1 系统变量

系统变量是 Makefile 中已经定义好的变量，可以直接使用，常用的系统变量如下：

| 变量名  | 说明                                     |
| ------- | ---------------------------------------- |
| `$@`    | 当前规则的目标文件                       |
| `$^`    | 当前规则的所有依赖文件                   |
| `$<`    | 当前规则的第一个依赖文件                 |
| `$?`    | 当前规则的所有比目标文件新的依赖文件     |
| `$*`    | 当前规则的目标文件去掉后缀的部分         |
| `$(@D)` | 当前规则的目标文件所在的目录             |
| `$(@F)` | 当前规则的目标文件的文件名               |
| `$(@B)` | 当前规则的目标文件的文件名去掉后缀的部分 |

### 4.2 自定义变量

自定义变量是 Makefile 中自己定义的变量，可以通过`=`或者`:=`来定义变量，其中`=`是最基本的赋值，而`:=`是覆盖之前的赋值。

## 5. Makefile 的函数

Makefile 的函数分为字符串函数、文件函数、条件函数、foreach 函数、call 函数等。

### 5.1 字符串函数

字符串函数主要用于处理字符串，常用的字符串函数如下：

| 函数名          | 说明                                                                                     |
| --------------- | ---------------------------------------------------------------------------------------- |
| `$(subst)`      | 将字符串中的某个字符替换成另一个字符，语法为`$(subst <from>,<to>,<text>)`                |
| `$(patsubst)`   | 将字符串中的某个模式替换成另一个模式，语法为`$(patsubst <pattern>,<replacement>,<text>)` |
| `$(strip)`      | 去掉字符串中开头和结尾的空格，语法为`$(strip <string>)`                                  |
| `$(findstring)` | 查找字符串中是否包含某个子串，语法为`$(findstring <find>,<in>)`                          |
| `$(filter)`     | 过滤字符串中的某些子串，语法为`$(filter <pattern...>,<text>)`                            |

...

### 5.2 文件函数

文件函数主要用于处理文件，常用的文件函数如下：

| 函数名        | 说明                                                    |
| ------------- | ------------------------------------------------------- |
| `$(wildcard)` | 查找某个目录下的所有文件，语法为`$(wildcard <pattern>)` |
| `$(shell)`    | 执行系统命令，语法为`$(shell <command>)`                |
| `$(dir)`      | 获取文件所在的目录，语法为`$(dir <names...>)`           |

...

### 5.3 条件函数

条件函数主要用于判断条件，常用的条件函数如下：

| 函数名       | 说明                                                       |
| ------------ | ---------------------------------------------------------- |
| `$(if)`      | 判断条件是否成立，语法为`$(if <condition>,<then-part>)`    |
| `$(or)`      | 判断条件是否成立，语法为`$(or <condition...>)`             |
| `$(and)`     | 判断条件是否成立，语法为`$(and <condition...>)`            |
| `$(foreach)` | 遍历列表，语法为`$(foreach <var>,<list>,<text>)`           |
| `$(call)`    | 调用函数，语法为`$(call <expression>,<parm1>,<parm2>,...)` |

...

## 6. Makefile 的条件判断

Makefile 的条件判断主要用于判断变量的值，常用的条件判断如下：

| 条件判断 | 说明                                                  |
| -------- | ----------------------------------------------------- |
| `ifeq`   | 判断两个变量是否相等，语法为`ifeq (<arg1>,<arg2>)`    |
| `ifneq`  | 判断两个变量是否不相等，语法为`ifneq (<arg1>,<arg2>)` |
| `ifdef`  | 判断变量是否已经定义，语法为`ifdef <variable>`        |

## 7. Makefile 的循环

## 8. Makefile 的自动化变量

Makefile 的自动化变量是指在 Makefile 中自带的变量，常用的自动化变量如下：
